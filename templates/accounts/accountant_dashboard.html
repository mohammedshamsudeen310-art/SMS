{% extends "accounts/base_dashboard.html" %}
{% block title %}Accountant Dashboard{% endblock %}
{% block header %}üí∞ Accountant Dashboard{% endblock %}

{% block content %}
<style>
/* üé® ===== Modern Accountant Dashboard (Refined Layout) ===== */

/* Overall container */
.dashboard-wrapper {
  display: flex;
  flex-direction: column;
  gap: 2.5rem;
  animation: fadeIn 0.6s ease-in-out;
  padding: 1rem 0;
}

/* Header */
.dashboard-header {
  text-align: center;
  margin-bottom: 0.5rem;
}
.dashboard-header h2 {
  color: #0d47a1;
  font-weight: 800;
  font-size: 1.8rem;
}
.dashboard-header p {
  color: #555;
  font-size: 0.95rem;
}

/* üåü Summary Cards */
.summary-cards {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1.5rem;
}

.card {
  background: linear-gradient(145deg, #ffffff, #f3f6fa);
  border-radius: 16px;
  padding: 25px 20px;
  text-align: center;
  box-shadow: 0 8px 18px rgba(0,0,0,0.08);
  transition: all 0.3s ease;
  border: 1px solid rgba(0,0,0,0.05);
}
.card:hover {
  transform: translateY(-4px);
  box-shadow: 0 12px 25px rgba(0,0,0,0.1);
}
.card h3 {
  color: #1a237e;
  font-weight: 600;
  margin-bottom: 6px;
  font-size: 1rem;
}
.card p {
  color: #0b6be0;
  font-size: 1.8rem;
  font-weight: 800;
}

/* üìà Charts Section */
.charts-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
  gap: 1.5rem;
}
.chart-card {
  background: #fff;
  border-radius: 14px;
  padding: 20px;
  box-shadow: 0 6px 18px rgba(0,0,0,0.06);
  border: 1px solid rgba(0,0,0,0.04);
}
.chart-card h3 {
  color: #1a237e;
  font-weight: 600;
  margin-bottom: 12px;
  font-size: 1rem;
}

/* üìä Payment Table */
.table-section {
  background: #fff;
  border-radius: 14px;
  padding: 20px;
  box-shadow: 0 6px 18px rgba(0,0,0,0.06);
}
.table-section h3 {
  color: #0d47a1;
  font-size: 1.1rem;
  font-weight: 700;
  margin-bottom: 15px;
}
.table {
  width: 100%;
  border-collapse: collapse;
  overflow: hidden;
  border-radius: 10px;
}
.table th, .table td {
  padding: 12px 15px;
  text-align: left;
  border-bottom: 1px solid #e0e7ff;
}
.table th {
  background: #0b6be0;
  color: white;
  font-weight: 600;
}
.table tr:hover {
  background-color: #f3f6fa;
}

/* ‚ö° Quick Actions */
.quick-actions {
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
  justify-content: center;
}
.quick-actions a {
  background: linear-gradient(135deg, #1565c0, #42a5f5);
  color: #fff;
  padding: 12px 20px;
  border-radius: 12px;
  text-decoration: none;
  font-weight: 600;
  transition: 0.3s ease;
  box-shadow: 0 6px 16px rgba(21,101,192,0.3);
}
.quick-actions a:hover {
  background: linear-gradient(135deg, #1e88e5, #1565c0);
  transform: translateY(-2px);
}

/* ‚ú® Animations */
@keyframes fadeIn {
  from {opacity: 0; transform: translateY(10px);}
  to {opacity: 1; transform: translateY(0);}
}

/* Responsive */
@media (max-width: 768px) {
  .dashboard-header h2 { font-size: 1.5rem; }
  .card p { font-size: 1.4rem; }
  .charts-grid { grid-template-columns: 1fr; }
}
</style>

<div class="dashboard-wrapper">

  <!-- üëã Header -->
  <div class="dashboard-header">
    <h2>Welcome, {{ user.get_full_name|default:user.username }}</h2>
    <p>Track fees, payments, and financial performance in real-time.</p>
  </div>

  <!-- üí≥ Summary Cards -->
  <div class="summary-cards">
    <div class="card"><h3>Total Students</h3><p>{{ total_students }}</p></div>
    <div class="card"><h3>Total Invoices</h3><p>{{ total_invoices }}</p></div>
    <div class="card"><h3>Total Fees Paid</h3><p>‚Çµ{{ total_paid }}</p></div>
    <div class="card"><h3>Fees Due</h3><p>‚Çµ{{ total_due }}</p></div>
    <div class="card"><h3>Pending Balance</h3><p>‚Çµ{{ total_balance }}</p></div>
  </div>

  <!-- üìä Payment Overview -->
  <div class="table-section">
    <h3>Payment Status Overview</h3>
    <table class="table">
      <tr><th>Status</th><th>Count</th><th>Amount (‚Çµ)</th></tr>
      <tr><td>‚úÖ Fully Paid</td><td>{{ fully_paid }}</td><td>{{ total_paid }}</td></tr>
      <tr><td>üü° Partially Paid</td><td>{{ partially_paid }}</td><td>{{ pending_total }}</td></tr>
      <tr><td>‚ùå Unpaid</td><td>{{ unpaid }}</td><td>‚Çµ{{ total_due }}</td></tr>
    </table>
  </div>

  <!-- üìà Charts -->
  <div class="charts-grid">
    <div class="chart-card">
      <h3>üìä Fee Collection Overview</h3>
      <canvas id="feeChart"></canvas>
    </div>
    <div class="chart-card">
      <h3>üìà Monthly Revenue Trend</h3>
      <canvas id="revenueChart"></canvas>
    </div>
  </div>

  <!-- ‚öôÔ∏è Quick Actions -->
  <div class="quick-actions">
    <a href="{% url 'record_payment' %}">‚ûï Record Payment</a>
    {% comment %} <a href="#">üßæ Generate Invoice</a> {% endcomment %}
    <a href="{% url 'conversation_list' %}">üì§ Send Reminder</a>
    <a href="{% url 'financial_report' %}">üìä View Reports</a>
  </div>

</div>

<!-- ‚úÖ Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{{ monthly_labels|json_script:"monthlyLabels" }}
{{ monthly_revenue|json_script:"monthlyRevenue" }}
<script>
  const monthlyLabels = JSON.parse(document.getElementById("monthlyLabels").textContent);
  const monthlyRevenue = JSON.parse(document.getElementById("monthlyRevenue").textContent);

  new Chart(document.getElementById("revenueChart"), {
    type: 'line',
    data: {
      labels: monthlyLabels,
      datasets: [{
        label: "Monthly Revenue (‚Çµ)",
        data: monthlyRevenue,
        borderColor: "#1565c0",
        backgroundColor: "rgba(21,101,192,0.15)",
        tension: 0.4,
        fill: true
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { display: false } },
      scales: { y: { beginAtZero: true } }
    }
  });

  new Chart(document.getElementById("feeChart"), {
    type: 'bar',
    data: {
      labels: ["Fully Paid", "Partially Paid", "Unpaid"],
      datasets: [{
        data: [{{ fully_paid|default:0 }}, {{ partially_paid|default:0 }}, {{ unpaid|default:0 }}],
        backgroundColor: ["#00c853", "#ffca28", "#e53935"],
      }]
    },
    options: {
      plugins: { legend: { display: false } },
      scales: { y: { beginAtZero: true } }
    }
  });
</script>
{% endblock %}
