{% extends "accounts/base_dashboard.html" %}

{% block title %}Manage Students{% endblock %}
{% block header %}ðŸŽ“ Manage Students{% endblock %}

{% block content %}
<div class="page-section">

  <!-- ðŸ”¹ Summary Section -->
  <div class="summary-cards">
    <div class="summary-card total">
      <h3>Total Students</h3>
      <p>{{ total_students }}</p>
    </div>

    {% if query %}
    <div class="summary-card search">
      <h3>Results for "{{ query }}"</h3>
      <p>{{ students|length }}</p>
    </div>
    {% endif %}
  </div>

  <!-- ðŸ”¹ Action Links -->
  <div class="action-bar">
    <a href="{% url 'add_student' %}" class="action-link add">âž• Add Student</a>
    <a href="{% url 'manage_promotions' %}" class="action-link promote">ðŸš€ Promote Students</a>
    <a href="{% url 'import_students' %}" class="action-link import">ðŸ“¥ Import Students</a>
  </div>

  <!-- ðŸ” Search & Filter -->
  <div class="top-bar">
    <h2>Student List</h2>
    <form method="get" class="search-form">
      <input type="text" name="q" placeholder="ðŸ” Search by name, ID, class..." value="{{ query }}">

      <select name="status">
        <option value="all" {% if status == "all" %}selected{% endif %}>All</option>
        <option value="active" {% if status == "active" %}selected{% endif %}>Active</option>
        <option value="inactive" {% if status == "inactive" %}selected{% endif %}>Inactive</option>
      </select>

      <button type="submit">Search</button>
    </form>
  </div>

  <!-- ðŸ“‹ Scrollable Student Table -->
  <div class="table-container">
    <table class="data-table">
      <thead>
        <tr>
          <th>#</th>
          <th>Full Name</th>
          <th>Email</th>
          <th>Class</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for student in students %}
        <tr>
          <td>{{ forloop.counter }}</td>
          <td>{{ student.user.get_full_name }}</td>
          <td>{{ student.user.email }}</td>
          <td>{{ student.current_class }}</td>
          <td>
            {% if student.user.is_active %}
              <span class="status active">Active</span>
            {% else %}
              <span class="status inactive">Inactive</span>
            {% endif %}
          </td>
          <td>
            <a href="{% url 'edit_student' student.pk %}" class="btn edit">Edit</a>
            <a href="{% url 'delete_student' student.pk %}" class="btn delete" 
               onclick="return confirm('Are you sure you want to delete this student?')">Delete</a>
          </td>
        </tr>
        {% empty %}
        <tr><td colspan="6" style="text-align:center; color:#888;">No students found.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- ðŸ”¹ Styles -->
<style>
.page-section {
  padding: 2rem;
  font-family: 'Segoe UI', sans-serif;
  background: #f5f6fa;
}

/* Summary Cards */
.summary-cards {
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
  margin-bottom: 1.5rem;
}

.summary-card {
  flex: 1;
  min-width: 180px;
  background: #fff;
  border-radius: 12px;
  padding: 1rem 1.5rem;
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  text-align: center;
  transition: transform 0.3s ease;
}
.summary-card:hover { transform: translateY(-4px); }
.summary-card h3 { font-size: 1rem; color: #2d3748; margin-bottom: 0.3rem; }
.summary-card p { font-size: 1.6rem; font-weight: 700; color: #004aad; }
.summary-card.total { border-left: 5px solid #28a745; }
.summary-card.search { border-left: 5px solid #ff9800; }

/* Action Bar Buttons */
.action-bar {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
  margin-bottom: 20px;
}

.action-link {
  display: inline-block;
  padding: 10px 16px;
  border-radius: 8px;
  font-weight: 600;
  color: #fff;
  text-decoration: none;
  transition: 0.3s ease;
  box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
}
.action-link.add { background-color: #28a745; }
.action-link.add:hover { background-color: #218838; }
.action-link.promote { background-color: #ff9800; }
.action-link.promote:hover { background-color: #e68900; }
.action-link.import { background-color: #007bff; }
.action-link.import:hover { background-color: #0069d9; }

/* Top Bar Search & Filter */
.top-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
  flex-wrap: wrap;
}
.search-form {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}
.search-form input, 
.search-form select {
  padding: 8px 12px;
  border-radius: 6px;
  border: 1px solid #ccc;
  outline: none;
  transition: 0.3s;
}
.search-form input:focus,
.search-form select:focus {
  border-color: #004aad;
  box-shadow: 0 0 4px rgba(0,74,173,0.3);
}
.search-form button {
  background: #004aad;
  color: #fff;
  border: none;
  padding: 8px 16px;
  border-radius: 6px;
  cursor: pointer;
  transition: 0.3s;
}
.search-form button:hover { background: #1565c0; }

/* ðŸ“± Scrollable Table Container */
.table-container {
  width: 100%;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  border-radius: 12px;
  background: #fff;
  box-shadow: 0 3px 10px rgba(0,0,0,0.1);
}

/* Data Table */
.data-table {
  width: 100%;
  min-width: 700px; /* Ensures scroll on small screens */
  border-collapse: collapse;
  background: #fff;
}
.data-table th, .data-table td {
  padding: 12px 15px;
  border-bottom: 1px solid #eee;
  text-align: left;
  white-space: nowrap;
}
.data-table th {
  background: #004aad;
  color: #fff;
  position: sticky;
  top: 0;
  z-index: 2;
}

.btn {
  padding: 6px 10px;
  border-radius: 6px;
  color: #fff;
  font-size: 0.9rem;
  text-decoration: none;
}
.btn.edit { background: #2196F3; }
.btn.delete { background: #f44336; }
.btn:hover { opacity: 0.9; }

.status.active { color: #16a34a; font-weight: 600; }
.status.inactive { color: #dc2626; font-weight: 600; }

/* ðŸ”¸ Responsive Adjustments */
@media (max-width: 768px) {
  .summary-cards { flex-direction: column; }
  .top-bar { flex-direction: column; align-items: flex-start; gap: 0.8rem; }
  .search-form { width: 100%; }
  .search-form input, .search-form select, .search-form button { flex: 1; min-width: 100%; }
  .action-bar { flex-direction: column; gap: 10px; }
}
</style>
{% endblock %}
