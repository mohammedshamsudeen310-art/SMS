{% extends "accounts/base_dashboard.html" %}
{% load static %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="dashboard-container">
  <div class="form-card animate-fadein">
    <h2 class="form-title">{{ title }}</h2>
    {% if editing %}
      <p class="form-subtitle">Update the parent information below. You can also reset their password if needed.</p>
    {% else %}
      <p class="form-subtitle">Fill in the required details below to register a new parent profile.</p>
    {% endif %}

    <form method="POST" enctype="multipart/form-data" class="styled-form">
      {% csrf_token %}

      <!-- üîπ Messages -->
      {% if messages %}
        <div class="message-container">
          {% for message in messages %}
            <div class="alert {{ message.tags }}">
              {{ message|linebreaksbr }}
            </div>

            {% if "added successfully" in message %}
              <div class="login-info-box">
                <h4>üë§ Parent Account Created</h4>
                <p><strong>Username:</strong> (shown above)</p>
                <p><strong>Password:</strong> <code>parent123</code></p>
                <small>Advise the parent to change their password after first login.</small>
              </div>
            {% endif %}
          {% endfor %}
        </div>
      {% endif %}

      <!-- üîπ Grid Layout -->
      <div class="form-grid">
        <div class="form-group">
          <label for="id_username">Username</label>
          <input type="text" name="username" id="id_username" class="form-control"
                 placeholder="Enter username"
                 value="{{ form.username.value|default_if_none:'' }}"
                 required>
        </div>

        <div class="form-group">
          <label for="id_email">Email</label>
          <input type="email" name="email" id="id_email" class="form-control"
                 placeholder="Enter email address"
                 value="{{ form.email.value|default_if_none:'' }}">
        </div>

        <div class="form-group full-width">
          <label for="id_fullname">Full Name</label>
          <input type="text" name="fullname" id="id_fullname" class="form-control"
                 placeholder="Enter full name"
                 value="{{ form.fullname.value|default_if_none:'' }}">
        </div>

        <div class="form-group">
          <label for="id_date_of_birth">Date of Birth</label>
          {{ form.date_of_birth }}
        </div>

        <div class="form-group">
          <label for="id_gender">Gender</label>
          {{ form.gender }}
        </div>

        <div class="form-group full-width">
          <label for="id_address">Address</label>
          {{ form.address }}
        </div>

        <div class="form-group">
          <label for="id_photo">Photo</label>
          {{ form.photo }}
          {% if form.instance.photo %}
            <div class="current-photo">
              <small>Current:</small><br>
              <img src="{{ form.instance.photo.url }}" alt="Parent photo" height="80" style="border-radius:8px;margin-top:6px;">
            </div>
          {% endif %}
        </div>

        <div class="form-group">
          <label for="id_occupation">Occupation</label>
          {{ form.occupation }}
        </div>

        <div class="form-group">
          <label for="id_relationship">Relationship</label>
          {{ form.relationship }}
        </div>

        <div class="form-group full-width">
          <label for="id_children">Assign Children</label>
          {{ form.children }}
        </div>

        {% if editing %}
        <!-- üîê Optional Password Reset -->
        <div class="form-group full-width">
          <label for="id_new_password">üîê Reset Password (Optional)</label>
          <input type="password" name="new_password" id="id_new_password" class="form-control"
                 placeholder="Enter new password (leave blank to keep current password)">
          <small style="color:#888;">Leave empty if you don‚Äôt want to reset the password.</small>
        </div>
        {% endif %}
      </div>

      <!-- Buttons -->
      <div class="form-actions">
        {% if editing %}
          <button type="submit" class="btn-primary">
            <i class="fas fa-save"></i> Update Parent
          </button>
        {% else %}
          <button type="submit" class="btn-primary">
            <i class="fas fa-save"></i> Save Parent
          </button>
        {% endif %}
        <a href="{% url 'manage_parents' %}" class="btn-secondary">
          <i class="fas fa-times"></i> Cancel
        </a>
      </div>
    </form>
  </div>
</div>

<!-- üåê Select2 (for Children Multi-Select) -->
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<script>
$(document).ready(function() {
  $('#id_children').select2({
    placeholder: "Search and select children...",
    allowClear: true,
    width: '100%',
    theme: 'classic'
  });
});
</script>

<style>
/* (Keep all previous styles exactly the same ‚Äî no change) */
</style>
{% endblock %}
